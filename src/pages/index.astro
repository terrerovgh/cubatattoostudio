---
import { getCollection } from "astro:content";
import BaseLayout from "../layouts/BaseLayout.astro";
import HeroSection from "../components/sections/HeroSection.astro";
import ArtistsSection from "../components/sections/ArtistsSection.astro";
import GallerySectionWrapper from "../components/sections/GallerySectionWrapper.astro";
import BookingSection from "../components/sections/BookingSection.astro";
import PromosSection from "../components/sections/PromosSection.astro";

export const prerender = true;

const allSections = await getCollection("sections");
console.log(
  "Index.astro sections loaded:",
  allSections.map((s) => s.id),
);
const sections = allSections.sort(
  (a, b) => (a.data.order || 99) - (b.data.order || 99),
);
---

<BaseLayout>
  {
    sections.map((section) => {
      const { data } = section;

      if (data.sectionLayout === "hero-center") {
        return (
          <HeroSection
            id={data.id || "hero"}
            backgroundImage={data.backgroundImage || ""}
            title={data.title || ""}
            subtitle={data.subtitle || ""}
          />
        );
      }

      if (data.sectionLayout === "profile-card") {
        return (
          <ArtistsSection
            id={data.id || "artists"}
            backgroundImage={data.backgroundImage || ""}
            title={data.title || ""}
            artists={data.artists || []}
          />
        );
      }

      if (data.sectionLayout === "grid-gallery") {
        return (
          <GallerySectionWrapper
            id={data.id || "gallery"}
            backgroundImage={data.backgroundImage || ""}
            title={data.title || ""}
            subtitle={data.subtitle || ""}
            services={data.services || []}
          />
        );
      }

      if (data.sectionLayout === "booking-cta") {
        return (
          <BookingSection
            id={data.id || "booking"}
            backgroundImage={data.backgroundImage || ""}
            title={data.title || ""}
            subtitle={data.subtitle || ""}
            bookingUrl={data.bookingUrl || "/booking"}
            phone={data.phone || ""}
            email={data.email || ""}
            address={data.address || ""}
          />
        );
      }

      if (data.sectionLayout === "promo-grid") {
        return (
          <PromosSection
            id={data.id || "promos"}
            backgroundImage={data.backgroundImage || ""}
            title={data.title || ""}
            subtitle={data.subtitle || ""}
            promos={data.promos || []}
          />
        );
      }

      return null;
    })
  }
</BaseLayout>
